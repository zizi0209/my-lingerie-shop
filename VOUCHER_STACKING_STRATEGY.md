# Chiáº¿n lÆ°á»£c Khuyáº¿n mÃ£i - MÃ´ hÃ¬nh "ThÃ¡p 3 Táº§ng" (3-Layer Stack)

> **Má»¥c tiÃªu**: CÃ¢n báº±ng giá»¯a kÃ­ch cáº§u khÃ¡ch hÃ ng vÃ  báº£o toÃ n lá»£i nhuáº­n

---

## 1. Táº¡i sao KHÃ”NG nÃªn cho nháº­p 3 loáº¡i mÃ£ code?

Náº¿u cho phÃ©p khÃ¡ch nháº­p cÃ¹ng lÃºc: `MÃ£ SP riÃªng` + `MÃ£ tá»•ng Ä‘Æ¡n` + `MÃ£ ship`:

| Váº¥n Ä‘á» | Háº­u quáº£ |
|--------|---------|
| **Vá»¡ tráº­n giÃ¡ (Triple Stacking)** | Giáº£m chá»“ng giáº£m Äƒn mÃ²n háº¿t lá»£i nhuáº­n |
| **Rá»‘i loáº¡n UX** | KhÃ¡ch pháº£i tÃ¬m vÃ  nháº­p quÃ¡ nhiá»u mÃ£, gÃ¢y má»‡t má»i |
| **UI phá»©c táº¡p** | Giá» hÃ ng 5-10 SP mÃ  má»—i SP 1 Ã´ nháº­p mÃ£ â†’ nÃ¡t UI |

---

## 2. MÃ´ hÃ¬nh "ThÃ¡p 3 Táº§ng" (The 3-Layer Stack)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ÄÆ N HÃ€NG (ORDER)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Táº¦NG 1: GIÃ KHUYáº¾N MÃƒI Sáº¢N PHáº¨M (Campaign/Flash Sale)        â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚ â€¢ CÃ¡ch hoáº¡t Ä‘á»™ng: Admin cÃ i Ä‘áº·t trong trang quáº£n lÃ½ sáº£n pháº©m  â”‚ â”‚
â”‚  â”‚ â€¢ VÃ­ dá»¥: Ão lÃ³t gá»‘c 500k â†’ Sale cÃ²n 400k (Giáº£m 20%)           â”‚ â”‚
â”‚  â”‚ â€¢ KhÃ¡ch hÃ ng: NhÃ¬n tháº¥y giÃ¡ Ä‘Ã£ giáº£m sáºµn, KHÃ”NG cáº§n nháº­p mÃ£    â”‚ â”‚
â”‚  â”‚ â€¢ Ãp dá»¥ng: Tá»° Äá»˜NG                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Táº¦NG 2: MÃƒ GIáº¢M GIÃ ÄÆ N HÃ€NG (Shop Voucher)                  â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚ â€¢ CÃ¡ch hoáº¡t Ä‘á»™ng: KhÃ¡ch NHáº¬P hoáº·c CHá»ŒN tá»« danh sÃ¡ch           â”‚ â”‚
â”‚  â”‚ â€¢ VÃ­ dá»¥: MÃ£ VIP50 giáº£m 50k, MÃ£ GIAM10 giáº£m 10%                â”‚ â”‚
â”‚  â”‚ â€¢ Quy táº¯c: CHá»ˆ ÄÆ¯á»¢C ÃP Dá»¤NG 1 MÃƒ duy nháº¥t á»Ÿ táº§ng nÃ y         â”‚ â”‚
â”‚  â”‚ â€¢ TÃ­nh toÃ¡n: % giáº£m trÃªn giÃ¡ SAU táº§ng 1 (khÃ´ng pháº£i giÃ¡ gá»‘c) â”‚ â”‚
â”‚  â”‚ â€¢ Ãp dá»¥ng: THá»¦ CÃ”NG (Input/Select)                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Táº¦NG 3: MÃƒ Váº¬N CHUYá»‚N (Shipping Voucher)                     â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚ â€¢ CÃ¡ch hoáº¡t Ä‘á»™ng: KhÃ¡ch NHáº¬P hoáº·c CHá»ŒN tá»« danh sÃ¡ch           â”‚ â”‚
â”‚  â”‚ â€¢ VÃ­ dá»¥: FREESHIP miá»…n phÃ­ ship, SHIP20K giáº£m 20k             â”‚ â”‚
â”‚  â”‚ â€¢ Quy táº¯c: ÄÆ¯á»¢C ÃP Dá»¤NG SONG SONG vá»›i Táº§ng 2                  â”‚ â”‚
â”‚  â”‚ â€¢ Ãp dá»¥ng: THá»¦ CÃ”NG (Input/Select)                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÃ´ng thá»©c tá»‘i Æ°u:

```
GiÃ¡ Sale (Tá»± Ä‘á»™ng) + 1 MÃ£ giáº£m giÃ¡ Ä‘Æ¡n hÃ ng (Input) + 1 MÃ£ Freeship (Input)
```

---

## 3. VÃ­ dá»¥ Minh há»a Thá»±c táº¿

```
KHÃCH MUA: Ão A (Gá»‘c 500k, Ä‘ang Flash Sale cÃ²n 400k)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº§ng 1 - GiÃ¡ Sale (Tá»° Äá»˜NG)                             â”‚
â”‚ GiÃ¡ gá»‘c: 500,000Ä‘  â†’  GiÃ¡ sale: 400,000Ä‘                â”‚
â”‚ âœ“ ÄÃ£ Ã¡p dá»¥ng tá»± Ä‘á»™ng                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº§ng 2 - MÃ£ giáº£m giÃ¡ (KHÃCH NHáº¬P)                       â”‚
â”‚ KhÃ¡ch nháº­p: VIP50 (Giáº£m 50k)                            â”‚
â”‚ Tiá»n hÃ ng: 400,000Ä‘ - 50,000Ä‘ = 350,000Ä‘                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº§ng 3 - MÃ£ ship (KHÃCH NHáº¬P)                           â”‚
â”‚ PhÃ­ ship: 30,000Ä‘                                       â”‚
â”‚ KhÃ¡ch nháº­p: FREESHIP                                    â”‚
â”‚ Tiá»n ship: 30,000Ä‘ - 30,000Ä‘ = 0Ä‘                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tá»”NG THANH TOÃN: 350,000Ä‘                               â”‚
â”‚                                                         â”‚
â”‚ KhÃ¡ch cáº£m nháº­n: ÄÆ°á»£c 3 Æ°u Ä‘Ã£i (Sale + Voucher + Ship)   â”‚
â”‚ Shop kiá»ƒm soÃ¡t: GiÃ¡ cuá»‘i 350k (khÃ´ng bá»‹ giáº£m quÃ¡ sÃ¢u)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Táº¡i sao KHÃ”NG nÃªn cÃ³ mÃ£ code riÃªng cho tá»«ng sáº£n pháº©m?

### Váº¥n Ä‘á»:
- Giá» hÃ ng cÃ³ 5-10 sáº£n pháº©m â†’ Pháº£i nháº­p 10 mÃ£ code?
- UI thanh toÃ¡n sáº½ nÃ¡t bÆ°Æ¡m vÃ¬ Ã´ nháº­p mÃ£

### Giáº£i phÃ¡p thay tháº¿ - DÃ¹ng CONDITIONS:

Náº¿u muá»‘n giáº£m giÃ¡ riÃªng cho nhÃ³m sáº£n pháº©m (VD: Chá»‰ giáº£m Ão LÃ³t, khÃ´ng giáº£m Quáº§n LÃ³t):

```
TÃªn mÃ£: SALE_AO_LOT
Cáº¥u hÃ¬nh Admin: 
  - Äiá»u kiá»‡n: "Ãp dá»¥ng cho danh má»¥c Ão LÃ³t"
  - Giáº£m: 20%

Khi khÃ¡ch Ã¡p mÃ£:
â†’ Há»‡ thá»‘ng tá»± lá»c cÃ¡c sáº£n pháº©m Ão LÃ³t Ä‘á»ƒ giáº£m
â†’ Quáº§n LÃ³t giá»¯ nguyÃªn giÃ¡
```

---

## 5. PhÃ¢n loáº¡i Coupon trong Database

### Category (PhÃ¢n loáº¡i chÃ­nh):

| Category | MÃ´ táº£ | Táº§ng |
|----------|-------|------|
| `DISCOUNT` | MÃ£ giáº£m giÃ¡ Ä‘Æ¡n hÃ ng | Táº§ng 2 |
| `SHIPPING` | MÃ£ giáº£m/miá»…n phÃ­ ship | Táº§ng 3 |

### DiscountType (Loáº¡i giáº£m):

| Type | MÃ´ táº£ | Category |
|------|-------|----------|
| `PERCENTAGE` | Giáº£m theo % | DISCOUNT |
| `FIXED_AMOUNT` | Giáº£m sá»‘ tiá»n cá»‘ Ä‘á»‹nh | DISCOUNT |
| `FREE_SHIPPING` | Miá»…n phÃ­ ship | SHIPPING |
| `SHIPPING_DISCOUNT` | Giáº£m tiá»n ship | SHIPPING |

### Conditions (Äiá»u kiá»‡n Ã¡p dá»¥ng):

```json
{
  "minOrderValue": 500000,      // ÄÆ¡n tá»‘i thiá»ƒu
  "maxDiscount": 100000,        // Giáº£m tá»‘i Ä‘a (cho %)
  "categoryIds": [1, 2, 3],     // Chá»‰ Ã¡p dá»¥ng cho danh má»¥c
  "productIds": [10, 20],       // Chá»‰ Ã¡p dá»¥ng cho SP cá»¥ thá»ƒ
  "excludeCategoryIds": [4],    // Loáº¡i trá»« danh má»¥c
  "userTiers": ["GOLD", "VIP"]  // Chá»‰ cho háº¡ng thÃ nh viÃªn
}
```

---

## 6. Thá»© tá»± TÃ­nh toÃ¡n (Calculation Order)

```
BÆ¯á»šC 1: TÃ­nh Subtotal (Ä‘Ã£ bao gá»“m giÃ¡ Sale - Táº§ng 1)
        â””â”€ items.reduce((sum, item) => sum + item.salePrice * item.quantity)
        
BÆ¯á»šC 2: (-) Ãp MÃ£ giáº£m giÃ¡ DISCOUNT (Táº§ng 2)
        â””â”€ Chá»‰ tÃ­nh trÃªn Subtotal
        â””â”€ Náº¿u cÃ³ conditions.categoryIds â†’ chá»‰ giáº£m SP thuá»™c danh má»¥c
        â””â”€ Náº¿u % thÃ¬ check maxDiscount
        = Subtotal After Discount
        
BÆ¯á»šC 3: (+) Cá»™ng PhÃ­ váº­n chuyá»ƒn (Shipping Fee)
        = Total Before Shipping Voucher
        
BÆ¯á»šC 4: (-) Ãp MÃ£ váº­n chuyá»ƒn SHIPPING (Táº§ng 3)
        â””â”€ Chá»‰ trá»« tá»‘i Ä‘a = Shipping Fee (khÃ´ng Ã¢m)
        = GRAND TOTAL (KhÃ¡ch thanh toÃ¡n)
```

### VÃ­ dá»¥ tÃ­nh toÃ¡n:

```
Subtotal (giÃ¡ sale):         400,000Ä‘
(-) MÃ£ VIP50 (giáº£m 50k):   -  50,000Ä‘
= After Discount:            350,000Ä‘
(+) PhÃ­ ship:              +  30,000Ä‘
= Before Ship Voucher:       380,000Ä‘
(-) MÃ£ FREESHIP:           -  30,000Ä‘
= GRAND TOTAL:               350,000Ä‘
```

---

## 7. UX/UI Checkout - Chuáº©n Shopee Style

### TrÃªn trang Checkout:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ·ï¸ SHOP VOUCHER                               [Chá»n mÃ£ >] â”‚
â”‚  âœ“ VIP50 - Giáº£m 50,000Ä‘                        -50,000Ä‘    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸšš SHIPPING VOUCHER                           [Chá»n mÃ£ >] â”‚
â”‚  âœ“ FREESHIP - Miá»…n phÃ­ váº­n chuyá»ƒn              -30,000Ä‘    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Popup chá»n mÃ£:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chá»n Voucher                                          [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Nháº­p mÃ£: [____________] [Ãp dá»¥ng]                       â”‚
â”‚      (DÃ¹ng cho mÃ£ bÃ­ máº­t/riÃªng tÆ°)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ·ï¸ SHOP VOUCHER (chá»n 1)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ GIAM10%    Giáº£m 10% tá»‘i Ä‘a 100k    ÄÆ¡n tá»« 500k   â”‚   â”‚
â”‚  â”‚ â— VIP50      Giáº£m 50,000Ä‘            ÄÆ¡n tá»« 300k   â”‚   â”‚
â”‚  â”‚ â—‹ AOLOT20    Giáº£m 20% cho Ão LÃ³t     ÄÆ¡n tá»« 200k   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ğŸšš SHIPPING VOUCHER (chá»n 1)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â— FREESHIP   Miá»…n phÃ­ váº­n chuyá»ƒn     ÄÆ¡n tá»« 500k   â”‚   â”‚
â”‚  â”‚ â—‹ SHIP20K    Giáº£m 20k ship           ÄÆ¡n tá»« 200k   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ Mua thÃªm 100,000Ä‘ Ä‘á»ƒ dÃ¹ng mÃ£ GIAM100K                  â”‚
â”‚                                                             â”‚
â”‚                                          [XÃ¡c nháº­n]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Schema Database (ÄÃ£ triá»ƒn khai)

### Coupon:
```prisma
model Coupon {
  id              Int       @id @default(autoincrement())
  code            String    @unique
  name            String
  category        String    @default("DISCOUNT")  // DISCOUNT | SHIPPING
  discountType    String    // PERCENTAGE | FIXED_AMOUNT | FREE_SHIPPING
  discountValue   Float
  maxDiscount     Float?    // Giáº£m tá»‘i Ä‘a (cho %)
  minOrderValue   Float?    // ÄÆ¡n tá»‘i thiá»ƒu
  conditions      Json?     // Äiá»u kiá»‡n nÃ¢ng cao
  // ... other fields
}
```

### Cart:
```prisma
model Cart {
  id                 Int      @id @default(autoincrement())
  // Voucher Stacking: Tá»‘i Ä‘a 2 mÃ£
  discountCouponId   Int?     // MÃ£ giáº£m giÃ¡ (Táº§ng 2)
  discountCouponCode String?
  shippingCouponId   Int?     // MÃ£ ship (Táº§ng 3)
  shippingCouponCode String?
  // ... other fields
}
```

---

## 9. API Endpoints (ÄÃ£ triá»ƒn khai)

```
# Ãp dá»¥ng Shop Voucher (Táº§ng 2)
POST /api/cart/:id/apply-discount
Body: { code: "VIP50" }

# Ãp dá»¥ng Shipping Voucher (Táº§ng 3)
POST /api/cart/:id/apply-shipping
Body: { code: "FREESHIP" }

# Gá»¡ mÃ£
DELETE /api/cart/:id/remove-discount
DELETE /api/cart/:id/remove-shipping

# Láº¥y danh sÃ¡ch mÃ£ kháº£ dá»¥ng (phÃ¢n loáº¡i sáºµn)
GET /api/cart/:id/available-vouchers
Response: {
  subtotal: 400000,
  discountVouchers: [...],   // Shop Vouchers
  shippingVouchers: [...]    // Shipping Vouchers
}

# TÃ­nh toÃ¡n tá»•ng Ä‘Æ¡n
POST /api/cart/:id/calculate
Body: { shippingFee: 30000 }
Response: {
  subtotal: 400000,
  discountAmount: 50000,
  shippingFee: 30000,
  shippingDiscount: 30000,
  grandTotal: 350000
}
```

---

## 10. Tá»•ng káº¿t

### Quy táº¯c vÃ ng:
1. **Táº§ng 1 (GiÃ¡ Sale)**: Tá»° Äá»˜NG - Admin cÃ i trong sáº£n pháº©m
2. **Táº§ng 2 (Shop Voucher)**: CHá»ˆ 1 MÃƒ - KhÃ¡ch chá»n/nháº­p
3. **Táº§ng 3 (Shipping Voucher)**: CHá»ˆ 1 MÃƒ - ÄÆ°á»£c stack vá»›i Táº§ng 2

### KhÃ´ng nÃªn:
- âŒ Cho nháº­p mÃ£ riÃªng cho tá»«ng sáº£n pháº©m
- âŒ Cho stack nhiá»u mÃ£ cÃ¹ng loáº¡i
- âŒ TÃ­nh % trÃªn giÃ¡ gá»‘c (pháº£i tÃ­nh trÃªn giÃ¡ Ä‘Ã£ sale)

### NÃªn lÃ m:
- âœ… DÃ¹ng CONDITIONS Ä‘á»ƒ giáº£m theo danh má»¥c/sáº£n pháº©m
- âœ… Hiá»ƒn thá»‹ rÃµ 2 khu vá»±c: Shop Voucher + Shipping Voucher
- âœ… Gá»£i Ã½ mÃ£ tá»‘t nháº¥t cho khÃ¡ch
- âœ… Hiá»ƒn thá»‹ "Mua thÃªm X Ä‘á»ƒ dÃ¹ng mÃ£ Y"
